# 运行时数据区域

## 程序计数器

### 什么是程序计数器

程序计数器是一个记录着当前线程所执行的字节码的行号指示器。

　　JAVA代码编译后的字节码在未经过JIT（实时编译器）编译前，其执行方式是通过“字节码解释器”进行解释执行。简单的工作原理为解释器读取装载入内存的字节码，按照顺序读取字节码指令。读取一个指令后，将该指令“翻译”成固定的操作，并根据这些操作进行分支、循环、跳转等流程。

　　从上面的描述中，可能会产生程序计数器是否是多余的疑问。因为沿着指令的顺序执行下去，即使是分支跳转这样的流程，跳转到指定的指令处按顺序继续执行是完全能够保证程序的执行顺序的。假设程序永远只有一个线程，这个疑问没有任何问题，也就是说并不需要程序计数器。但实际上程序是通过多个线程协同合作执行的。

　　首先我们要搞清楚JVM的多线程实现方式。JVM的多线程是通过CPU时间片轮转（即线程轮流切换并分配处理器执行时间）算法来实现的。也就是说，某个线程在执行过程中可能会因为时间片耗尽而被挂起，而另一个线程获取到时间片开始执行。当被挂起的线程重新获取到时间片的时候，它要想从被挂起的地方继续执行，就必须知道它上次执行到哪个位置，在JVM中，通过程序计数器来记录某个线程的字节码执行位置。因此，程序计数器是具备线程隔离的特性，也就是说，每个线程工作时都有属于自己的独立计数器。

### 程序计数器的工作原理

1. 程序计数器创建与线程创建时。
2. 线程创建完成就知道了整个生命周期的工作内容（全部字节码内容），但是需要工作台（CPU）里面把任务一条条处理。
3. 工作台（CPU）不会允许任何一个线程一直占有工作台，各个线程必须轮换着来，轮换规则由系统指定。
4. 任何一个线程离开工作台时都需要记录自己任务做到了哪一步（具体哪一行的字节码），需要保存这个行数，记录这个行数的地方被称为程序计数器。
5. 线程重新回到工作台（CPU轮换过来），需要打开自己的程序计数器，看看自己做到了哪一步，然后继续向下执行。

1-5就是程序计数器工作背景和原理，现在我们考虑一个新的问题，当一个线程到了第5步，可以继续执行了，但是有一个问题，就是上一次被轮换到工作台肯定会产生一些结果性的数据，那些数据存在哪里？程序又应该怎么找到？这个问题等阅读完其它的运行数据区域你应该就有答案了。

## Java虚拟机栈



<font color="red">程序计数器有遗留问题</font>