### IO操作常用函数

- open

  > 调用函数open可以打开或者创建一个文件
  >
  > - int open(path，flag，.... )
  > - int openat(fd，path，flag，....)
  >
  > flag参数支持多种选项，例如`O_RDONLY`、`O_RDWR`、`O_CREAT`等，并且可以使用`或`运算构成新的参数，例如`O_RDONLY|O_CREAT` 表示文件不存在时创建并以只读形式打开

- create

  > 创建一个文件
  >
  > - create(path，mode)
  >
  > mode - 创建文件时选择的格式
  >
  > create 创建的文件默认是以只写的形式创建的

- read

  > 从打开的文件中读取数据
  >
  > ```c
  > ssize_t read(int fd, void *buf, size_t nbytes);
  > ```
  >
  > 如果read成功，则返回读到的字节数，到达文件尾端时返回0 ，返回-1代表出错
  >
  > - 读普通文件时，在读到要求的字节数之前达到了尾端，返回实际字节数
  > - 从终端读取时，通常一次读取最多一行
  > - 网络读时，由于网络缓冲机制可能造成返回值小于所要求读的字节数
  > - 管道读或者队列读，若是管道内字节小雨所要求的字节，返回实际读取字节数
  > - 

- write

  > 向打开的文件中写数据
  >
  > ```c
  > ssize_t write(int fd,const void * buf,size_t nbytes);
  > ```
  >
  > 如果写成功，返回已写字节数，若出错，返回-1
  >
  > 常见出错：
  >
  > - 磁盘已满
  > - 超过进程文件长度限制
  >
  > 对于普通文件，写操作从文件的当前偏移量开始，如果打开文件时指定了O_APPEND选项，则在每次写操作之前，将文件的偏移量设置在文件的当前结尾处，在每次写成功后，文件偏移量增加实际写的字节数。

- close

  > 关闭打开的文件
  >
  > - close(fd)
  >
  > 关闭文件会释放文件上的所有记录锁；进程结束时，内核自动关闭进程打开的所有文件

- lseek

  > 我们现在有两个文件，分别是`A.txt`和`B.txt`，其中A文件有如下内容
  >
  > > Hello Lseek
  >
  > B文件则是空白文件，显然这两个文件的内容不同，那么我们怎样标记这个不同呢？
  >
  > 答案就是`当前文件偏移量`，
  >
  > 通常打开文件时，读写操作都从文件偏移量开始，并使偏移量增加本次打开所读写的字节数，可以通过
  >
  > - lseek(fd，offset，mode)
  >
  > 设置该值

### [文件描述符](./express_word.md)

**文件描述符的获取：**当打开或者新建文件时，内核向进程返回一个文件描述符

**文件描述符的使用：**当使用read或者write函数时，参数使用文件描述符

**文件描述符的范围：**取决于每个进程允许打开的文件数上限（不同的操作系统或有不同）

### IO的效率

使用read和write复制一个文件[copy_file](./copy_file.txt)，代码见[copy](./copy.c)
